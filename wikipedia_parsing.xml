<meta_metadata_repository name="wikipedia_parsing" default_user_agent_name="chrome_2" package="ecologylab.semantics.conceptmapping.generated" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">

	<meta_metadata name="wikipedia_page_for_parsing" extends="wikipedia_page_type" comment="Used to parse wikipedia pages for concept mapping project.">

		<mm_scalar_field name="title" xpath="//h1[@class='firstHeading']" />

		<mm_collection_field name="paragraphs" child_type="paragraph" xpath="//div[@id='bodyContent']//p[string-length(.)>0]">
			<mm_scalar_field name="paragraph_text" xpath="string(.)" />
			<mm_collection_field name="anchors" child_type="anchor" xpath=".//a[string-length(./@title)>0]">
				<mm_scalar_field name="link" xpath="./@href" /> <!-- not used -->
				<mm_scalar_field name="anchor_text" xpath="string(.)" /> <!-- surface -->
				<mm_scalar_field name="target_concept" scalar_type="String" xpath="./@title" />
			</mm_collection_field>
		</mm_collection_field>

		<mm_collection_field name="categories" child_type="category" xpath="//div[@id='mw-normal-catlinks']/span/a">
			<mm_scalar_field name="name" xpath="./@title" />
			<mm_scalar_field name="cat_link" xpath="./@href" />
		</mm_collection_field>

		<!-- semantic actions used to collect outlinks and category information -->
		<semantic_actions>
			<get_field name="title" />
			<get_field name="location" />
			<create_concept>
				<arg value="title" name="title" />
				<arg value="location" name="location" />
			</create_concept>

			<get_field name="paragraphs" />
			<for_each collection="paragraphs" as="paragraph">
				<get_field object="paragraph" name="anchors" />
				<for_each collection="anchors" as="anchor">
					<get_field object="anchor" name="anchor_text" />
					<get_field object="anchor" name="target_concept" />
					<add_concept_outlink>
						<arg value="anchor_text" name="surface" />
						<arg value="target_concept" name="target_concept" />
					</add_concept_outlink>
				</for_each>
			</for_each>

			<get_field name="categories" />
			<for_each collection="categories" as="category">
				<get_field object="category" name="name" />
				<add_concept_category>
					<arg value="name" name="category" />
				</add_concept_category>
			</for_each>

			<finish_concept />
		</semantic_actions>
		
		<!--  semantic actions used to parse the whole article for link detection -->
		<semantic_actions>
		    <get_field name="paragraphs" />
		    <parse_paragraphs_with_anchors>
		        <arg value="paragraphs" name="paragraphs" />
		    </parse_paragraphs_with_anchors>
		</semantic_actions>

	</meta_metadata>

</meta_metadata_repository>
